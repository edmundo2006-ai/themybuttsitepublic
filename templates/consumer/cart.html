{% extends "layout.html" %}

{% block content %}
<div class="mx-auto max-w-3xl px-4 py-10">
  <h2 class="mb-6 text-center text-2xl font-bold text-gray-900 dark:text-gray-100">Order Summary</h2>

  {% if cart and cart.items %}
    <!-- Cart Items -->
    <ul class="mb-6 overflow-hidden rounded-2xl ring-1 ring-gray-200 shadow-sm bg-white dark:bg-gray-900 dark:ring-gray-700">
      {% for item in cart.items %}
      <li class="border-b border-gray-100 last:border-0 dark:border-gray-800">
        <div class="flex items-start gap-3 px-4 py-3">
          <div class="font-semibold text-gray-900 dark:text-gray-100">
            {{ item.menu_item.name }} - {{ item.menu_item.price | format_price }}
          </div>

          <form action="{{ url_for('consumer_api.remove_from_cart') }}" method="post" class="ml-auto">
            <input type="hidden" name="item_id" value="{{ item.id }}">
            <button type="submit"
                    class="btn btn-danger btn-sm inline-flex items-center rounded-lg bg-[#EE1B2D] px-3 py-1.5 text-sm font-semibold text-white shadow-sm hover:brightness-95">
              Remove
            </button>
          </form>
        </div>

        {% if item.selected_ingredients %}
        <div class="px-4 pb-4">
          <p class="mt-1 text-sm font-semibold text-gray-800 dark:text-gray-200">Ingredients:</p>
          <ul class="mt-1 list-disc pl-6 text-sm text-gray-700 dark:text-gray-300">
            {% for ingredient_link in item.selected_ingredients %}
            <li>
              {{ ingredient_link.ingredient.name }}
              {% if ingredient_link.addon_price > 0 %}
                (+{{ ingredient_link.addon_price | format_price }})
              {% endif %}
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}
      </li>
      {% endfor %}
    </ul>

    <!-- Price Breakdown -->
    <div class="mb-6 overflow-hidden rounded-2xl ring-1 ring-gray-200 shadow-sm bg-white dark:bg-gray-900 dark:ring-gray-700">
      <div class="border-b border-gray-100 px-5 py-3 font-semibold text-gray-900 dark:border-gray-800 dark:text-gray-100">
        Price Breakdown:
      </div>
      <ul class="divide-y divide-gray-100 dark:divide-gray-800">
        {% for item in cart.items %}
        <li class="px-5 py-3 text-gray-800 dark:text-gray-200">
          {{ item.menu_item.name }} - {{ item.effective_price | format_price }}
        </li>
        {% endfor %}
        <li class="px-5 py-3 font-bold text-gray-900 dark:text-gray-100">
          Total Price - {{ total_price | format_price }}
        </li>
      </ul>
    </div>

    <!-- General specifications form -->
    <form action="{{ url_for('consumer_pages.checkout_summary') }}" method="post" class="mt-4">
      <label for="cart_specifications" class="block text-sm font-medium text-gray-900 dark:text-gray-100">
        General Specifications (max 40 characters):
      </label>
      <input type="text" class="mt-2 block w-full rounded-xl border border-gray-300 bg-white px-4 py-2 text-gray-900
                                shadow-sm focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30
                                dark:border-gray-700 dark:bg-gray-900 dark:text-gray-100"
             id="cart_specifications" name="cart_specifications"
             maxlength="40" value="{{ cart.specifications or '' }}">

      <div class="mt-4 flex justify-center gap-3">
        <button type="submit"
                class="btn btn-success inline-flex items-center justify-center rounded-xl bg-[#16a34a] px-5 py-3 font-semibold text-white shadow-sm hover:brightness-95">
          Proceed to Checkout
        </button>
      </div>
    </form>

    <!-- Clear cart button -->
    <form action="{{ url_for('consumer_api.clear_cart') }}" method="post" class="mt-3 text-center">
      <button type="submit"
              class="btn btn-outline-danger btn-sm inline-flex items-center justify-center rounded-xl border border-[#EE1B2D] px-4 py-2 text-sm font-semibold text-[#EE1B2D] hover:bg-[#EE1B2D]/10">
        Clear Cart
      </button>
    </form>

  {% else %}
    <p class="text-center text-gray-700 dark:text-gray-300">Your cart is empty.</p>
  {% endif %}
</div>

<div class="mt-6 flex justify-center">
  <a href="{{ url_for('consumer_pages.buttery') }}"
     class="inline-flex items-center justify-center rounded-xl bg-gray-500 px-5 py-3 font-semibold text-white shadow-sm hover:brightness-95 dark:bg-gray-600">
    Back to Menu
  </a>
</div>

{% endblock %}
